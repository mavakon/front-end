<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Family Hub – Home</title>
    <link href="https://fonts.cdnfonts.com/css/cocon" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
<div class="layout">
    <aside class="sidebar" role="region" aria-label="Main menu">
        <header class="sidebar-header">
            <h2>Menu</h2>
        </header>
        <nav class="menu-container" aria-label="Site navigation">
            <ul class="menu-list">
                <li><a href="index.html">Home</a></li>
                <li><a href="weather.html">Weather</a></li>
                <li><a href="wishlist.html">Wishlist</a></li>
                <li><a href="plans.html">Plans</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
        </nav>
    </aside>

    <main class="content">
        <img src="images/logo.png" alt="Family Hub Logo" class="logo">
        <header class="page-header">
            <h1>Welcome to Family Hub</h1>
        </header>
        <div id="home-root"></div>

        <!-- React Home App -->
        <script type="text/babel">
            // Main Home App Component
            function HomeApp() {
                const [isLoggedIn, setIsLoggedIn] = React.useState(false);
                const [username, setUsername] = React.useState('');
                const [recentItems, setRecentItems] = React.useState([]);
                const [loading, setLoading] = React.useState(true);
                const [error, setError] = React.useState('');

                // Get current time for dynamic styling and greeting
                const currentHour = new Date().getHours();
                const isDarkMode = currentHour < 6 || currentHour >= 20; // Dark mode between 8 PM and 6 AM

                // Determine greeting based on time of day
                let greeting = "Good morning";
                if (currentHour >= 12 && currentHour < 18) {
                    greeting = "Good afternoon";
                } else if (currentHour >= 18) {
                    greeting = "Good evening";
                }

                // Check if user is logged in on component mount
                React.useEffect(() => {
                    const checkLoginStatus = async () => {
                        try {
                            // Get username from cookie
                            const cookies = document.cookie.split(';');
                            const usernameCookie = cookies.find(cookie => cookie.trim().startsWith('username='));

                            if (usernameCookie) {
                                const user = usernameCookie.split('=')[1];
                                setUsername(user);
                                setIsLoggedIn(true);

                                // Fetch recent wishlist items if logged in
                                try {
                                    const response = await fetch('/api/wishlist');

                                    if (response.ok) {
                                        const data = await response.json();
                                        setRecentItems(data.slice(0, 3)); // Get up to 3 most recent items
                                    }
                                } catch (err) {
                                    console.error('Error fetching wishlist:', err);
                                }
                            }
                        } catch (err) {
                            console.error('Error checking login status:', err);
                        } finally {
                            setLoading(false);
                        }
                    };

                    checkLoginStatus();
                }, []);

                const containerStyle = {
                    padding: '20px',
                    backgroundColor: isDarkMode ? '#333' : '#fff',
                    color: isDarkMode ? '#eee' : '#333',
                    borderRadius: '8px',
                    boxShadow: '0 2px 10px rgba(0,0,0,0.1)',
                    marginBottom: '30px'
                };

                const headingStyle = {
                    color: isDarkMode ? '#9cf' : '#4a7a8c',
                    marginBottom: '15px'
                };

                const buttonStyle = {
                    padding: '10px 15px',
                    backgroundColor: isDarkMode ? '#5c8a9d' : '#4a7a8c',
                    color: 'white',
                    border: 'none',
                    borderRadius: '4px',
                    cursor: 'pointer',
                    fontSize: '16px',
                    marginRight: '10px',
                    textDecoration: 'none',
                    display: 'inline-block'
                };

                const handleLogout = async () => {
                    try {
                        await fetch('/api/logout', { method: 'POST' });
                        setIsLoggedIn(false);
                        setUsername('');
                        setRecentItems([]);
                        window.location.reload();
                    } catch (err) {
                        console.error('Error logging out:', err);
                    }
                };

                if (loading) {
                    return (
                        <div style={{ textAlign: 'center', padding: '20px' }}>
                            <p>Loading...</p>
                        </div>
                    );
                }

                return (
                    <div>
                        <section className="intro-text" style={containerStyle}>
                            <h2 style={headingStyle}>{greeting}, {isLoggedIn ? username : 'Guest'}!</h2>
                            <p>Useful tools for the whole family in one place.</p>

                            {isLoggedIn ? (
                                <div style={{ marginTop: '15px' }}>
                                    <p>You are logged in. <a href="#" onClick={handleLogout} style={{ color: isDarkMode ? '#9cf' : '#4a7a8c' }}>Logout</a></p>
                                </div>
                            ) : (
                                <div style={{ marginTop: '15px' }}>
                                    <a href="/login.html" style={buttonStyle}>Login</a>
                                    <a href="/register.html" style={buttonStyle}>Register</a>
                                </div>
                            )}
                        </section>

                        <section id="main-content" style={containerStyle}>
                            <h2 style={headingStyle}>Family Hub Features</h2>
                            <p>Family Hub brings together all the essential tools your family needs in one convenient place. Stay organized, connected, and informed with our easy-to-use features.</p>

                            {isLoggedIn && recentItems.length > 0 && (
                                <div style={{ marginTop: '20px' }}>
                                    <h3 style={{ ...headingStyle, fontSize: '18px' }}>Your Recent Wishlist Items</h3>
                                    <ul style={{ listStyle: 'none', padding: '0' }}>
                                        {recentItems.map((item, index) => (
                                            <li key={index} style={{ 
                                                padding: '10px', 
                                                marginBottom: '10px', 
                                                backgroundColor: isDarkMode ? '#444' : '#f5f5f5',
                                                borderRadius: '4px'
                                            }}>
                                                <strong>{item.name}</strong> - {item.category}
                                                <p style={{ margin: '5px 0 0 0', fontSize: '14px' }}>{item.description || 'No description'}</p>
                                            </li>
                                        ))}
                                    </ul>
                                    <a href="/wishlist.html" style={{ color: isDarkMode ? '#9cf' : '#4a7a8c' }}>View all wishlist items →</a>
                                </div>
                            )}

                            <div style={{ marginTop: '20px' }}>
                                <h3 style={{ ...headingStyle, fontSize: '18px' }}>Current Time</h3>
                                <p>{new Date().toLocaleString()}</p>
                                <p>{isDarkMode ? 'Night mode is active based on the current time.' : 'Day mode is active based on the current time.'}</p>
                            </div>
                        </section>
                    </div>
                );
            }

            // Render the Home App
            const container = document.getElementById('home-root');
            const root = ReactDOM.createRoot(container);
            root.render(<HomeApp />);
        </script>
        <section class="plan-map">
            <svg viewBox="0 0 400 400" width="400" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Site map">
                <!-- HOME -->
                <a href="index.html">
                    <circle cx="200" cy="200" r="50" stroke="#333" fill="none"/>
                    <text x="200" y="205" text-anchor="middle" class="node-text">Home</text>
                </a>

                <!-- WEATHER -->
                <a href="weather.html">
                    <circle cx="200" cy="80" r="40" stroke="#333" fill="none"/>
                    <text x="200" y="85" text-anchor="middle" class="node-text">Weather</text>
                </a>

                <!-- WISHLIST -->
                <a href="wishlist.html">
                    <circle cx="200" cy="320" r="40" stroke="#333" fill="none"/>
                    <text x="200" y="325" text-anchor="middle" class="node-text">Wishlist</text>
                </a>

                <!-- PLANS -->
                <a href="plans.html">
                    <circle cx="80" cy="200" r="40" stroke="#333" fill="none"/>
                    <text x="80" y="205" text-anchor="middle" class="node-text">Plans</text>
                </a>

                <!-- ABOUT -->
                <a href="about.html">
                    <circle cx="320" cy="200" r="40" stroke="#333" fill="none"/>
                    <text x="320" y="205" text-anchor="middle" class="node-text">About</text>
                </a>
            </svg>
        </section>

    </main>
</div>
</body>
</html>
